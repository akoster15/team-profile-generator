{"version":3,"sources":["useImageNaturalDimensions.ts"],"names":["normalizeSize","dimension","options","containerDimension","enablePercentWidth","undefined","Number","isNaN","search","parseFloat","trim","match","deriveSpecifiedDimensionsFromProps","width","height","contentWidth","flatStyle","enableExperimentalPercentWidth","normalizeOptionsWidth","normalizeOptionsHeight","widthProp","heightProp","styleWidth","styleHeight","aspectRatio","useImageNaturalDimensions","props","source","style","cachedNaturalDimensions","naturalDimensions","setNaturalDimensions","StyleSheet","flatten","cachedNaturalWidth","cachedNaturalHeight","specifiedDimensions","error","setError","resetOnURIChange","uri","onNaturalDimensions","onError"],"mappings":"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","sourcesContent":["import { useState, useMemo, useEffect } from 'react';\nimport { StyleSheet } from 'react-native';\nimport { ImageDimensions } from '../shared-types';\nimport getDimensionsWithAspectRatio from './getDimensionsWithAspectRatio';\nimport { UseIMGElementStateProps } from './img-types';\n\ninterface IncompleteImageDimensions {\n  width: number | null;\n  height: number | null;\n}\n\nfunction normalizeSize(\n  dimension: string | number | null | undefined,\n  options: Partial<{\n    containerDimension: number | null;\n    enablePercentWidth: boolean;\n  }>\n) {\n  const containerDimension = options.containerDimension || null;\n  const enablePercentWidth = options.enablePercentWidth || false;\n  if (\n    dimension === null ||\n    dimension === undefined ||\n    Number.isNaN(dimension)\n  ) {\n    return null;\n  }\n  if (typeof dimension === 'number') {\n    return dimension;\n  }\n  if (\n    dimension.search('%') !== -1 &&\n    enablePercentWidth &&\n    typeof containerDimension === 'number'\n  ) {\n    return (parseFloat(dimension) * containerDimension) / 100;\n  } else if (dimension.trim().match(/^[\\d.]+$/)) {\n    return parseFloat(dimension);\n  }\n  return null;\n}\n\n/**\n * Extract specified dimensions from props.\n */\nfunction deriveSpecifiedDimensionsFromProps({\n  width,\n  height,\n  contentWidth,\n  flatStyle,\n  enableExperimentalPercentWidth: enablePercentWidth\n}: Pick<\n  UseIMGElementStateProps,\n  'width' | 'height' | 'contentWidth' | 'enableExperimentalPercentWidth'\n> & { flatStyle: Record<string, any> }): IncompleteImageDimensions {\n  const normalizeOptionsWidth = {\n    enablePercentWidth,\n    containerDimension: contentWidth\n  };\n  const normalizeOptionsHeight = {\n    enablePercentWidth: false\n  };\n  const widthProp = normalizeSize(width, normalizeOptionsWidth);\n  const heightProp = normalizeSize(height, normalizeOptionsHeight);\n  const styleWidth = normalizeSize(flatStyle.width, normalizeOptionsWidth);\n  const styleHeight = normalizeSize(flatStyle.height, normalizeOptionsHeight);\n  return getDimensionsWithAspectRatio(\n    styleWidth ?? widthProp,\n    styleHeight ?? heightProp,\n    flatStyle.aspectRatio\n  );\n}\n\nexport default function useImageNaturalDimensions<\n  P extends UseIMGElementStateProps\n>(props: P) {\n  const {\n    source,\n    contentWidth,\n    enableExperimentalPercentWidth,\n    width,\n    height,\n    style,\n    cachedNaturalDimensions\n  } = props;\n  const [naturalDimensions, setNaturalDimensions] = useState<\n    P['cachedNaturalDimensions'] extends ImageDimensions\n      ? ImageDimensions\n      : ImageDimensions | null\n  >((cachedNaturalDimensions as any) || null);\n  const flatStyle = useMemo(() => StyleSheet.flatten(style) || {}, [style]);\n  const { width: cachedNaturalWidth, height: cachedNaturalHeight } =\n    cachedNaturalDimensions || {};\n  const specifiedDimensions = useMemo(\n    () =>\n      deriveSpecifiedDimensionsFromProps({\n        contentWidth,\n        enableExperimentalPercentWidth,\n        width,\n        height,\n        flatStyle\n      }),\n    [contentWidth, enableExperimentalPercentWidth, flatStyle, height, width]\n  );\n  const [error, setError] = useState<null | Error>(null);\n  useEffect(\n    function resetOnURIChange() {\n      setNaturalDimensions(\n        (cachedNaturalWidth != null && cachedNaturalHeight != null\n          ? { width: cachedNaturalWidth, height: cachedNaturalHeight }\n          : null) as any\n      );\n      setError(null);\n    },\n    [cachedNaturalHeight, cachedNaturalWidth, source.uri]\n  );\n  return {\n    onNaturalDimensions: setNaturalDimensions,\n    onError: setError,\n    naturalDimensions,\n    specifiedDimensions,\n    flatStyle,\n    error\n  };\n}\n"]}